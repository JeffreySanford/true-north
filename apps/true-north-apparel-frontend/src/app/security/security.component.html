
<main class="security" role="main" aria-labelledby="security-heading">
  <mat-card class="primary-border">
  <h1 id="security-heading">Security Test Page</h1>
    <section class="user-info">
      <mat-card class="success-border">
        <mat-card-header>
          <mat-card-title>User Session</mat-card-title>
          <mat-card-subtitle *ngIf="isAuthenticated; else loggedOut">Authenticated</mat-card-subtitle>
          <ng-template #loggedOut><span class="warn">Not Authenticated</span></ng-template>
        </mat-card-header>
        <mat-card-content *ngIf="user$ | async as user">
          <div *ngIf="user; else noUser">
            <div><strong>Username:</strong> {{ user.username || 'N/A' }}</div>
            <div><strong>Role:</strong> {{ user.role || 'user' }}</div>
            <div><strong>JWT Expires:</strong> {{ user.exp || 'N/A' }}</div>
          </div>
          <ng-template #noUser>
            <div>No user session found.</div>
          </ng-template>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="warn" (click)="logout()" *ngIf="isAuthenticated">Logout</button>
        </mat-card-actions>
      </mat-card>
    </section>

    <section class="audit-log">
      <mat-card class="warning-border">
        <mat-card-header>
          <mat-card-title>Audit Log</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table mat-table [dataSource]="auditLog$ | async" class="mat-elevation-z1">
            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Action</th>
              <td mat-cell *matCellDef="let log">{{ log.action }}</td>
            </ng-container>
            <ng-container matColumnDef="timestamp">
              <th mat-header-cell *matHeaderCellDef>Timestamp</th>
              <td mat-cell *matCellDef="let log">{{ log.timestamp }}</td>
            </ng-container>
            <ng-container matColumnDef="user">
              <th mat-header-cell *matHeaderCellDef>User</th>
              <td mat-cell *matCellDef="let log">{{ log.user }}</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="['action', 'timestamp', 'user']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['action', 'timestamp', 'user']"></tr>
          </table>
        </mat-card-content>
      </mat-card>
    </section>
  </mat-card>
</main>
